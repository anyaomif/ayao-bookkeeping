# 记工系统接口文档

## 接口清单

| 接口名称     | 接口路径           | 请求方式 | 说明         |
| ------------ | ------------------ | -------- | ------------ |
| 用户注册     | /api/user/register | POST     | 注册新用户   |
| 用户登录     | /api/user/login    | POST     | 用户登录     |
| 获取用户信息 | /api/user/info     | GET      | 获取用户信息 |
| 更新用户信息 | /api/user/update   | PUT      | 更新用户信息 |
| 修改密码     | /api/user/password | PUT      | 修改用户密码 |
| 图片上传     | /api/upload        | POST     | 上传图片     |
| 创建记工记录 | /api/records       | POST     | 创建记工记录 |
| 获取记工列表 | /api/records       | GET      | 获取记工列表 |
| 获取记工详情 | /api/records/:id   | GET      | 获取单条记录 |
| 更新记工记录 | /api/records/:id   | PUT      | 更新记工记录 |
| 删除记工记录 | /api/records/:id   | DELETE   | 删除记工记录 |
| 创建项目 | /api/projects | POST | 创建新项目 |
| 获取项目列表 | /api/projects | GET | 获取项目列表 |
| 获取项目详情 | /api/projects/:id | GET | 获取单个项目 |
| 更新项目 | /api/projects/:id | PUT | 更新项目信息 |
| 删除项目 | /api/projects/:id | DELETE | 删除项目 |

## 通用说明

- 基础URL: `http://127.0.0.1:7001/api`

- 所有接口都需要在请求头中携带 token:

  ```
  Authorization: Bearer eyJhbGciOiJIUzI1...
  ```

- 响应格式统一为：

  ```
  {
    "success": true/false,
    "data": {}, // 成功时返回的数据
    "message": "错误信息" // 失败时返回的错误信息
  }
  ```

## 接口列表

## 记工模块

### 1. 创建记工记录

- **接口**: POST `/records`

- **描述**: 创建一条新的记工记录

- **请求体**:

  ```
  {
    "date": "2024-02-17", // 日期，必填
    "project": "碧桂园项目", // 项目名称，必填
    "type": "点工", // 类型：点工/包工，必填
    // 点工数据（type为"点工"时必填）
    "workOption": 0, // 0: 1个工, 1: 选工天, 2: 选小时, 3: 休息
    "workDays": 1, // 工天数
    "workHours": 0, // 工时数
    "hasOvertime": true, // 是否加班
    "overtimeDays": 0, // 加班天数
    "overtimeHours": 2, // 加班小时数
    // 包工数据（type为"包工"时必填）
    "contractOption": 0, // 0: 砌墙, 1: 贴砖, 2: 刷漆, 3: 其他
    "amount": 3000.50, // 包工金额
    // 通用字段
    "remark": "备注信息",
    "imageList": [ // 图片列表，支持base64或URL
      "http://example.com/image1.jpg",
      "data:image/jpeg;base64,..."
    ]
  }
  ```

- **响应示例**:

  ```
  {
    "success": true,
    "data": {
      "id": 1,
      "userId": 1,
      "date": "2024-02-17",
      "project": "碧桂园项目",
      "type": "点工",
      "workOption": 0,
      "workDays": 1,
      "workHours": 0,
      "hasOvertime": true,
      "overtimeDays": 0,
      "overtimeHours": 2,
      "remark": "备注信息",
      "images": ["http://example.com/image1.jpg"],
      "createdAt": "2024-02-17T10:00:00.000Z",
      "updatedAt": "2024-02-17T10:00:00.000Z"
    }
  }
  ```

### 2. 获取记工记录列表

- **接口**: GET `/records`

- **描述**: 获取当前用户的记工记录列表，支持分页和筛选

- **查询参数**:

  - `page`: 页码，默认1
  - `pageSize`: 每页条数，默认10
  - `date`: 按日期筛选
  - `project`: 按项目名称筛选
  - `type`: 按类型筛选（点工/包工）

- **响应示例**:

  ```
  {
    "success": true,
    "data": {
      "list": [{
        "id": 1,
        "userId": 1,
        "date": "2024-02-17",
        "project": "碧桂园项目",
        "type": "点工",
        "workOption": 0,
        "workDays": 1,
        "workHours": 0,
        "hasOvertime": true,
        "overtimeDays": 0,
        "overtimeHours": 2,
        "remark": "备注信息",
        "images": ["http://example.com/image1.jpg"],
        "createdAt": "2024-02-17T10:00:00.000Z",
        "updatedAt": "2024-02-17T10:00:00.000Z"
      }],
      "total": 1,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

### 3. 获取单条记工记录

- **接口**: GET `/records/:id`

- **描述**: 获取指定ID的记工记录详情

- **路径参数**:

  - `id`: 记录ID

- **响应示例**:

  ```
  {
    "success": true,
    "data": {
      "id": 1,
      "userId": 1,
      "date": "2024-02-17",
      "project": "碧桂园项目",
      "type": "点工",
      "workOption": 0,
      "workDays": 1,
      "workHours": 0,
      "hasOvertime": true,
      "overtimeDays": 0,
      "overtimeHours": 2,
      "remark": "备注信息",
      "images": ["http://example.com/image1.jpg"],
      "createdAt": "2024-02-17T10:00:00.000Z",
      "updatedAt": "2024-02-17T10:00:00.000Z"
    }
  }
  ```

### 4. 更新记工记录

- **接口**: PUT `/records/:id`
- **描述**: 更新指定ID的记工记录
- **路径参数**:
  - `id`: 记录ID
- **请求体**: 与创建记录相同，所有字段都是可选的
- **响应示例**: 与获取单条记录相同

### 5. 删除记工记录

- **接口**: DELETE `/records/:id`

- **描述**: 删除指定ID的记工记录

- **路径参数**:

  - `id`: 记录ID

- **响应示例**:

  ```
  {
    "success": true,
    "message": "删除成功"
  }
  ```

## 用户模块

### 6. 用户注册

- **接口**: POST `/user/register`
- **描述**: 注册新用户
- **请求体**:
  ```json
  {
    "username": "anyao",
    "password": "123456",
    "nickname": "小小安尧",
    "phone": "18515708827"
  }
  ```
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "username": "anyao",
      "nickname": "小小安尧",
      "phone": "18515708827",
      "token": "eyJhbGciOiJIUzI1..."
    }
  }
  ```

### 7. 用户登录
- **接口**: POST `/user/login`
- **描述**: 用户登录
- **请求体**:
  ```json
  {
    "username": "anyao",
    "password": "123456"
  }
  ```
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "username": "anyao",
      "nickname": "小小安尧",
      "phone": "18515708827",
      "token": "eyJhbGciOiJIUzI1..."
    }
  }
  ```

### 8. 获取用户信息
- **接口**: GET `/user/info`
- **描述**: 获取当前登录用户信息
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "username": "anyao",
      "nickname": "小小安尧",
      "phone": "18515708827",
      "avatar": "http://example.com/avatar.jpg"
    }
  }
  ```

### 9. 更新用户信息
- **接口**: PUT `/user/update`
- **描述**: 更新当前用户信息
- **请求体**:
  ```json
  {
    "nickname": "新昵称",
    "phone": "18515708827",
    "avatar": "http://example.com/new-avatar.jpg"
  }
  ```
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "username": "anyao",
      "nickname": "新昵称",
      "phone": "18515708827",
      "avatar": "http://example.com/new-avatar.jpg"
    }
  }
  ```

### 10. 修改密码
- **接口**: PUT `/user/password`
- **描述**: 修改当前用户密码
- **请求体**:
  ```json
  {
    "oldPassword": "123456",
    "newPassword": "654321"
  }
  ```
- **响应示例**:
  ```json
  {
    "success": true,
    "message": "密码修改成功"
  }
  ```

## 通用模块

### 11. 图片上传

- **接口**: POST `/upload`
- **描述**: 上传图片文件
- **请求体**: 
  - Content-Type: multipart/form-data
  - 参数名: file
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "url": "/public/uploads/202402171234567.jpg"
    }
  }
  ```

## 项目模块

### 12. 创建项目

- **接口**: POST `/api/projects`
- **描述**: 创建一个新的项目
- **请求头**:
  
  ```
  Authorization: Bearer <token>
  Content-Type: application/json
  ```
- **请求体**:
  ```json
  {
    "name": "碧桂园项目",              // 项目名称，必填
    "startDate": "2024-02-17",        // 开始时间，必填，格式：YYYY-MM-DD
    "endDate": "2024-12-31",          // 结束时间，选填，格式：YYYY-MM-DD
    "dailyWage": 300,                 // 点工日薪，必填
    "hourlyWage": 40,                 // 点工时薪，选填
    "overtimeWage": 50,               // 加班工资，选填
    "status": 1,                      // 项目状态：1进行中，2已完成，3已终止，默认1
    "location": "广州市天河区",        // 项目地点，选填
    "description": "碧桂园住宅项目",   // 项目描述，选填
    "contactPerson": "张三",          // 联系人，选填
    "contactPhone": "13800138000"     // 联系电话，选填
  }
  ```
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "userId": 1,
      "name": "碧桂园项目",
      "startDate": "2024-02-17T00:00:00.000Z",
      "endDate": "2024-12-31T00:00:00.000Z",
      "dailyWage": "300.00",
      "hourlyWage": "40.00",
      "overtimeWage": "50.00",
      "status": 1,
      "location": "广州市天河区",
      "description": "碧桂园住宅项目",
      "contactPerson": "张三",
      "contactPhone": "13800138000",
      "createdAt": "2024-02-17T10:00:00.000Z",
      "updatedAt": "2024-02-17T10:00:00.000Z"
    }
  }
  ```

### 13. 获取项目列表

- **接口**: GET `/api/projects`
- **描述**: 获取当前用户的项目列表，支持分页和筛选
- **请求头**:
  ```
  Authorization: Bearer <token>
  ```
- **查询参数**:
  - `page`: 页码，默认1
  - `pageSize`: 每页条数，默认10
  - `status`: 项目状态（1进行中，2已完成，3已终止）
  - `keyword`: 项目名称关键词搜索
- **响应示例**:
  ```json
  {
    "success": true,
    "data": {
      "list": [{
        "id": 1,
        "userId": 1,
        "name": "碧桂园项目",
        "startDate": "2024-02-17T00:00:00.000Z",
        "endDate": "2024-12-31T00:00:00.000Z",
        "dailyWage": "300.00",
        "hourlyWage": "40.00",
        "overtimeWage": "50.00",
        "status": 1,
        "location": "广州市天河区",
        "description": "碧桂园住宅项目",
        "contactPerson": "张三",
        "contactPhone": "13800138000",
        "createdAt": "2024-02-17T10:00:00.000Z",
        "updatedAt": "2024-02-17T10:00:00.000Z"
      }],
      "total": 1,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

### 14. 获取项目详情

- **接口**: GET `/api/projects/:id`
- **描述**: 获取指定ID的项目详情
- **请求头**:
  ```
  Authorization: Bearer <token>
  ```
- **路径参数**:
  - `id`: 项目ID
- **响应示例**: 同创建项目的响应格式

### 15. 更新项目

- **接口**: PUT `/api/projects/:id`
- **描述**: 更新指定ID的项目信息
- **请求头**:
  ```
  Authorization: Bearer <token>
  Content-Type: application/json
  ```
- **路径参数**:
  - `id`: 项目ID
- **请求体**: 同创建项目，所有字段都是可选的
- **响应示例**: 同创建项目的响应格式

### 16. 删除项目

- **接口**: DELETE `/api/projects/:id`
- **描述**: 删除指定ID的项目
- **请求头**:
  ```
  Authorization: Bearer <token>
  ```
- **路径参数**:
  - `id`: 项目ID
- **响应示例**:
  
  ```json
  {
    "success": true,
    "message": "删除成功"
  }
  ```

## 补充说明

1. 图片上传支持两种方式：
   - 直接上传文件（使用 `/upload` 接口）
   - Base64 图片数据（在记工记录接口中直接传输）
2. 用户相关接口中，除了注册和登录，其他接口都需要在请求头中携带 token
3. 头像图片建议不超过 2MB，记工图片每张不超过 5MB
4. 所有时间相关的字段都使用 ISO 8601 格式
5. 手机号码格式：11位数字
6. 密码要求：6-20位字符
